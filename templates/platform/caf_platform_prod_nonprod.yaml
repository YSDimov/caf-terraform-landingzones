#
# If you are changing a value in this file you need to execute the following command to update the definition folder
# 
# ansible-playbook $(readlink -f ./landingzones/templates/ansible/walk-through-single.yaml) \
#  --extra-vars "@$(readlink -f ./platform/definition/ignite.yaml)" \
#  -e base_folder=$(pwd)
# 
# then update the Terraform configuration files with
#
# ansible-playbook $(readlink -f ./landingzones/templates/ansible/ansible.yaml) \
#  --extra-vars "@$(readlink -f ./platform/definition/ignite.yaml)" \
#  -e base_folder=$(pwd)
# 
# 


deployments:
  scale_out_domain_keys:
    - prod
    - non_prod
  platform:
    root:
      {{default_region_key}}:
        launchpad: launchpad.yaml
        launchpad_credentials: launchpad_credentials.yaml
        platform_subscriptions: platform_subscriptions.yaml
        identity: identity.yaml
        management: management.yaml
        asvm: asvm.yaml
        security: security.yaml
        gitops_agents: gitops_agents_aci.yaml
    alz:
      {{default_region_key}}:
        {{alz_mg_prefix}}: alz.yaml
    scale_out_domains:
      {{default_region_key}}:
        identity_level2:
          prod: identity_level2.yaml
          non_prod: identity_level2.yaml
        virtual_wans:
          prod: connectivity_virtual_wans.yaml
        virtual_hubs:
          prod: connectivity_virtual_hubs.yaml
          non_prod: connectivity_virtual_hubs.yaml
        virtual_hubs_route_tables:
          prod: connectivity_virtual_hubs_route_tables.yaml
          non_prod: connectivity_virtual_hubs_route_tables.yaml
        azurerm_firewall_policies:
          prod: connectivity_firewall_policies.yaml
          non_prod: connectivity_firewall_policies.yaml
        secure_firewalls:
          prod: connectivity_secure_firewalls.yaml
          non_prod: connectivity_secure_firewalls.yaml
        private_dns_firewalls:
          prod: connectivity_private_dns_firewalls.yaml
          non_prod: connectivity_private_dns_firewalls.yaml
        private_dns:
          prod: connectivity_private_dns.yaml
          non_prod: connectivity_private_dns.yaml
        security_level2:
          prod: security_level2.yaml
          non_prod: security_level2.yaml


notifications:
  monitor_action_groups:
    networking_operations: {{default_email_address}}
  service_health_alerts: {{default_email_address}}
  azure_defender:
    emailSecurityContact: {{default_email_address}}


backup_policies:           
  vms:
    default:
      name: vm-default-policy
      # Default to UTC
      # possible values - https://jackstromberg.com/2017/01/list-of-time-zones-consumed-by-azure/
      timezone: SE Asia Standard Time
      backup:
        frequency: Daily
        time: "23:00"
      retention_daily:
        count: 7
      retention_weekly:
        count: 2
        weekdays:
          - Sunday
      retention_monthly:
        count: 2
        weeks:
          - First
        weekdays:
          - Sunday
      retention_yearly:
        count: 1
        weeks:
          - First
        months:
          - January
        weekdays:
          - Sunday

azure_landing_zones:
  identity:
    # Set the Azure Active Directory tenant name (primary domain name)
    # has to be the default domain name (custom dns name or tenantname.onmicrosoft.com)
    # check the AAD property
    tenant_name: {{ azure_landing_zones.identity.tenant_name | default(tenant_name)}}
    # only service_principal supported with rover ignite at the moment
    azuread_identity_mode: {{bootstrap.azuread_identity_mode}}
    enable_azuread_groups: {{bootstrap.enable_azuread_groups}}
    enable_azuread_applications: {{bootstrap.enable_azuread_applications}}
    # UPNs you want to add in the caf_platform_maintainers Azure AD group
    # Can use user or guest accounts
    # Those users will have full permissions on platform.
    # Once setup, you can remove them from here or add them from
    # Check in Azure AD the User Principal Name attribute value. Note there is a special convention for guest accounts.
    caf_platform_maintainers:
      user_principal_names:
        # - 
    caf_platform_contributors:
      user_principal_names:
        # - 
    backup_policy:
      vms: default

  management:
    backup_policy:
      vms: default

  security:
    backup_policy:
      vms: default

  connectivity:
    networking_bootstrap:
      deployment_option: virtual_wan
    backup_policy:
      vms: default

# cleanup_destination - recommended to clean and recreated a clean state from template.
configuration_folders:
  platform:
    # true: force the destination folder to be deleted and re-created before the files are created.
    # false: create the target folder structure if it does not exist. On sub-sequent executions, the folder structure is reused as is.
    cleanup_destination: true


management_groups:
{% for region, a_value in bootstrap.deployments.platform.alz.items() %}
  {{region}}:
{% for key in a_value.keys() %}
    {{alz_mg_prefix}}:
      management_group_prefix: "{{ bootstrap.management_groups[region].es.management_group_prefix | default(alz_mg_prefix)}}"
      management_group_name: "{{ bootstrap.management_groups[region].es.management_group_name | default(alz_mg_name)}}"
      deploy_core_landing_zones: {{bootstrap.management_groups[region].es.deploy_core_landing_zones | default(True)}}
      clean_up_destination_folder: {{bootstrap.management_groups[region].es.clean_up_destination_folder | default(True)}}
      update_lib_folder: {{bootstrap.management_groups[region].es.update_lib_folder | default(True)}}
      version_to_deploy: "{{bootstrap.management_groups[region].es.version_to_deploy | default('v1.1.3')}}"
{% if bootstrap.management_groups[region].es.root_parent_id is defined %}
      root_parent_id: "{{bootstrap.management_groups[region][key].root_parent_id}}"
{% endif %}
      tfstate:
        lz_key_name: alz_{{alz_mg_prefix}}
        tfstate: alz_{{alz_mg_prefix}}.tfstate
        level: level1
        identity_aad_key: cred_alz
        config_file: alz_{{alz_mg_prefix}}.yaml
        template_lib_folder: platform/level1/alz
        sub_template_folder: platform/level1/alz
        yaml: platform/level1/alz/ansible.yaml
        alz_version: v1.1.3
        # Do not rename the item_key_name
        tfstate_key_name: alz_{{alz_mg_prefix}}
{% endfor %}
{% endfor %}
